<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>2. Tracking objects • trackRcv</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="z2_tracking_objects_files/libs/quarto-html/popper.min.js"></script><script src="z2_tracking_objects_files/libs/quarto-html/tippy.umd.min.js"></script><link href="z2_tracking_objects_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="z2_tracking_objects_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="2. Tracking objects">
<meta property="og:image" content="https://swarm-lab.github.io/trackRcv/logo.svg">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">trackRcv</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/z1_installing_trackRcv.html">1. Installing trackRcv</a></li>
    <li><a class="dropdown-item" href="../articles/z2_tracking_objects.html">2. Tracking objects</a></li>
    <li><a class="dropdown-item" href="../articles/z3_fixing_tracks.html">3. Fixing tracks</a></li>
    <li><a class="dropdown-item" href="../articles/z4_visualizing_tracks.html">4. Visualizing tracks</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>2. Tracking objects</h1>

      <p class="author">Simon Garnier</p>



      <div class="d-none name"><code></code></div>
    </div>






    <section class="level2"><h2 id="introduction">0. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Once you are ready to process a video, you can launch the trackR by typing the following command in the R console:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://swarm-lab.github.io/trackRcv/">trackRcv</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/trackR.html">trackR</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="images/z0.jpg" class="quarto-figure quarto-figure-center" style="border-radius: 5px; border-style: groove;;width:40.0%"></p>
</figure>
</div>
<p>This will open the app launcher either in the viewer pane of RStudio and Positron, or in a separate window, depending on your local configuration. In RStudio at least, you can control where the app opens by setting the <code>launch.browser</code> option. For instance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/trackR.html">trackR</a></span><span class="op">(</span>launch.browser <span class="op">=</span> <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/viewer.html" class="external-link">paneViewer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<p>will launch the app in the RStudio viewer pane.</p>
<p>Once the launcher is running, click on the “Track” button to launch the tracking app. The launcher will close and the app will start shortly after.</p>
<hr></section><section class="level2"><h2 id="video-module">1. Video module<a class="anchor" aria-label="anchor" href="#video-module"></a>
</h2>
<p>The first step of the tracking process is to load a video file into the app. To do this, simply click the “Select video” button. This will bring up a navigator that you will use to locate the video file that you would like to process. Once you have located the video file in the navigator, click the “Select” button. The app will open the video and display its first image in the display window (see below).</p>
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="images/z2_1.jpg" class="quarto-figure quarto-figure-center" style="border-radius: 5px; border-style: groove;"></p>
</figure>
</div>
<p>You can navigate through the video by sliding the green tab along the timeline displayed below the video. The gray tabs can be used to restrict the analysis to a specific time interval of the video.</p>
<p>Once the app has opened the video, you can move to the “Background module” by clicking on the tab marked “2” on the right side of the control panel.</p>
<hr></section><section class="level2"><h2 id="background-module">2. Background module<a class="anchor" aria-label="anchor" href="#background-module"></a>
</h2>
<p>In the “Background module”, you can either choose to load an existing background image (e.g., an image of the empty experimental setup before the start of the experiment) or you can ask the app to automatically reconstruct that background from the video.</p>
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="images/z2_2.jpg" class="quarto-figure quarto-figure-center" style="border-radius: 5px; border-style: groove;"></p>
</figure>
</div>
<p>If you choose to select an existing background image, just click on the “Select existing background” button and use the navigator to locate and select the desired image. You can then skip the rest of this section and go directly to <a href="#mask-module">the next section</a>.</p>
<p>If you choose to let the app reconstruct the background from the video, you will first need to decide on two things:</p>
<ul>
<li>The “Background type” which correspond to the algorithm that the app will use to reconstruct the background. Four algorithms are available:
<ul>
<li>“Mean” computes a background image in which each pixel is the average of the corresponding pixels in the selected video frames. This is a fast algorithm. However it does not always produce good results.</li>
<li>“Median” computes a background image in which each pixel is the median of the corresponding pixels in the selected video frames. This usually produces a better result than “Mean”, but will take longer to complete.</li>
<li>“Minimum” computes a background image in which each pixel is the minimum of the corresponding pixels in the selected video frames. This usually produces a good result when the objects to isolate are lighter than the background.</li>
<li>“Maximum” computes a background image in which each pixel is the maximum of the corresponding pixels in the selected video frames. This usually produces a good result when the objects to isolate are darker than the background.</li>
</ul>
</li>
<li>The “Number of frames for estimating background”. Better results are usually obtained with larger number of frames but the background will be slower to reconstruct.</li>
</ul>
<p>Once you have selected these two parameters, click on the on the “Automatically estimate background” button and the app will start reconstructing the background from the video.</p>
<hr>
<p>In some occasions, like in the image on the left below, the app will not reconstruct the background completely. This can happen, for instance, when an object did not move at all during the entirety of the video like it is the case here.</p>
<p><img src="images/z2_3.jpg" class="quarto-figure quarto-figure-center" style="border-radius: 5px; border-style: groove;;width:49.0%"><img src="images/z2_4.jpg" class="quarto-figure quarto-figure-center" style="border-radius: 5px; border-style: groove;;width:49.0%"></p>
<p>You can fix some of these “ghosts” by clicking the “Select ghost for removal” button. This will allow you to draw a polygon around the object to remove from the background by using the left button of your mouse/trackpad. Once you have surrounded the object with a polygon, use the return key on your keyboard to close the polygon. The app will then use the pixels surrounding the polygon that you traced to replace the object with its best guess about the color of the background below it.</p>
<blockquote>
<p><strong>Note:</strong> the ghost removal mode is very basic and may not yield good results with complex backgrounds. Another option is to save the background file with the ghosts and use a more advanced image editing software to remove them (for instance, Photoshop’s <code>Remove tool</code> can give much better results).</p>
</blockquote>
<p>Once you are happy with background generated by the app, you can click the “Save background file” button to save the background image for later (re)use.</p>
<hr></section><section class="level2"><h2 id="mask-module">3. Mask module<a class="anchor" aria-label="anchor" href="#mask-module"></a>
</h2>
<p>The “Mask module” is optional and can be skipped. It should be used if you would like to restrict tracking to specific areas of the image, for instance to exclude the outside of an experimental arena where things may be moving that should not be tracked (e.g., the hands of the experimenter). By default, the app will use the entirety of the visible frame to perform the tracking.</p>
<div class="quarto-figure quarto-figure-center">
<figure><p><img src="images/z2_5.jpg" class="quarto-figure quarto-figure-center" style="border-radius: 5px; border-style: groove;"></p>
</figure>
</div>
<p>The control panel of the “Mask module” allows you to either use an existing mask or to design your own. To use an existing mask, click the “Select existing mask” button and use the navigator to locate and select the desired mask image. A mask image should be a grayscale image of the same resolution of the video. Non-black portions of the image will be included in the tracking while black portion will be excluded. Different shades of gray can be used to delimit different parts of the mask.</p>
<p>If you would like to design your own mask (or modify an existing mask that you have loaded in the app), you can use the following controls:</p>
<ul>
<li>“Include all” tells the app to use the entirety of the visible frame to perform the tracking. This is a useful button to reset the mask to its default setting.</li>
<li>“Exclude all” tells the app to use none of the visible frame to perform the tracking. This is a useful button to wipe out the mask before adding authorized areas for tracking using the “Add polygon ROI” and ”Add ellipse ROI” buttons.</li>
<li>“Add polygon ROI” (region of interest) allows you to draw a polygon on the mask by using the left button of your mouse/trackpad. Once you are sastified with your polygon, use the return key of your keyboard to close it. If the “Including” radio button is selected, then the area inside the polygon will be included in the tracking. Otherwise, it will be excluded.</li>
<li>“Add ellipse ROI” allows you to draw an ellipse on the mask by indicating 5 points along the periphery of the area of interest. Use the left button of your mouse/trackpad for this. Once you have finished adding the 5 points, the app will compute the ellipse best fitting them. It is recommended to select 5 points that are roughly equidistant along the periphery of the area of interest. If the “Including” radio button is selected, then the area inside the ellipse will be included in the tracking. Otherwise, it will be excluded.</li>
<li>“ROI id” allows you to assign a unique identifier to each region of interest, allowing for separating the tracking of objects in each of them in post-processing.</li>
</ul>
<p><img src="images/z2_6.jpg" class="quarto-figure quarto-figure-center" style="border-radius: 5px; border-style: groove;;width:49.0%"><img src="images/z2_7.jpg" class="quarto-figure quarto-figure-center" style="border-radius: 5px; border-style: groove;;width:49.0%"></p>
<p>You can combine including/excluding polygons and ellipses to define a mask as complex and detailed as you would like. Included areas will take a slightly greener tint in the display window while excluded areas will take a slightly more red tint (see images above).</p>
<p>Once you are satisfied with your design, you can save it for later (re)use by clicking the “Save mask file” button.</p>
<hr></section><section class="level2"><h2 id="segmentation-module">4. Segmentation module<a class="anchor" aria-label="anchor" href="#segmentation-module"></a>
</h2>
<p>Segmentation is the process of isolating objects of interests from the background of an image. In order to do so, the app first needs to know whether it is looking for objects that are darker or lighter than the background. You can do so by ticking the appropriate radio button at the top of the control panel in the “Segmentation module”.</p>
<p><img src="images/z2_8.jpg" style="border-radius: 5px; border-style: groove;"></p>
<p>Once this is done, the app will need to know how different from the background a pixel must be to be considered a part of one of the objects to isolate. In order to indicate that information to the app, you can use the threshold slider in the control panel. They will allow you to set the threshold difference above which a pixel is considered a part of an object and not a part of the background.</p>
<p>The objective is to find a threshold that creates a good separation between the objects to isolate and the background. You can see the result of changing the thresholds in the display window: all the parts of the image that are considered an object given the threshold will be surrounded by a green line (see image above). A good threshold will result in green lines tightly following the edges of the objects to isolate.</p>
<p>You can also let the app search for a good threshold by clicking the “Autothreshold” button in the control panel. The app can use multiple methods to estimate a threshold that provides good segmentation results. You can try select a method using the dropdown menu next to the “Autothreshold” button, and observe their effect by running the autothresholding operation again. You can then tweak manually this suggested threshold if you want.</p>
<p>Finally, you can exclude very fine details of the objects to isolate (e.g., the legs of the termites in the image above) by playing with the “Contour smoothing“ slider. This can be useful to obtain a more accurate tracking of the centers of mass of the objects (fine details can introduce unnecessary noise in the trajectory).</p>
<p>It is recommended to look at the result of the segmentation process in different parts of the video using the control slider below the video display. This will ensure that the selected threshold gives good results throughout the video.</p>
<hr></section><section class="level2"><h2 id="identification-module">5. Identification module<a class="anchor" aria-label="anchor" href="#identification-module"></a>
</h2>
<p>By default, the app can track objects reliably as long as they do not come in close contact with each other. When that happens, however, the app will use a number of heuristics to try and separate them. These heuristics are based on various parameters of the objects, namely:</p>
<ul>
<li>Their maximum width, in pixels</li>
<li>Their maximum height, in pixels</li>
<li>Their maximum surface area, in pixels</li>
<li>Their density, that is the ratio between their surface area and the surface area of the ellipse that is enclosing the object (objects with a high density resemble better perfect ellipses).</li>
</ul>
<p>You can set these parameters manually using the corresponding input boxes in the control panel of the “Identification module”. You can also let the app search for good values for these parameters by clicking the “Auto parameters” button in the control panel. The app will look for parameters that provide good separation results in general. You can then tweak manually these suggested parameters if you want.</p>
<p><img src="images/z2_9.jpg" style="border-radius: 5px; border-style: groove;"></p>
<p>It is recommended to look at the result of the identification process in different parts of the video using the control slider below the video display. This will ensure that the selected parameters give good results throughout the video.</p>
<hr></section><section class="level2"><h2 id="scaling-module">6. Scaling module<a class="anchor" aria-label="anchor" href="#scaling-module"></a>
</h2>
<p>By default, the app will set the origin of the coordinate system to the top-left corner of the video. You can change this by clicking the “Set origin” button in the control panel. You then use your mouse to click on the location in the video frame where you want the origin to be.</p>
<p><img src="images/z2_10.jpg" style="border-radius: 5px; border-style: groove;"></p>
<p>You can also set a scaling factor for directly converting the pixel coordinates into real-world coordinates. For this, click on the “Set scale” button in the control panel. You then use your mouse to select two points in the video frame that are known to be at a certain distance apart in the real world. A pop-up window will ask you to enter the distance between these two points and the unit of measurement you want to use. The app will then automatically convert all the tracking results into real-world coordinates for you.</p>
<hr></section><section class="level2"><h2 id="tracking-module">7. Tracking module<a class="anchor" aria-label="anchor" href="#tracking-module"></a>
</h2>
<p>You made it to the tracking module! You are just a few clicks away from starting to process your video.</p>
<p>There are a few more parameters that you can set before launching the tracking:</p>
<ul>
<li>“Look back” controls how many past frames the tracking algorithm should take into account to associate each detected object to a track. This is a useful parameter to take into account if, for instance, the objects tend to disappear for a few frames from time to time.</li>
<li>“Maximum distance” controls the maximum distance in pixels that an object can move between two frames to be still considered as belonging to the same track.</li>
<li>“Preview tracks during tracking” controls whether a preview of the tracking results should be displayed during the tracking process. The preview shows 1 frame per second of the video with the trajectories overlaid on top. This will slow down a bit the tracking process, but this can be used to check that the tracking is working well when deciding on the right set of tracking parameters.</li>
</ul>
<p><img src="images/z2_11.jpg" style="border-radius: 5px; border-style: groove;"></p>
<p>Once all is set, you can finally click on the “Start tracking” button, set a file in the navigator that pops up to store the tracking data, and just let the app works its magic. The data will be saved as a CSV file and <a href="#output">the next section</a> will detail the content of this file.</p>
<p><img src="images/z2_12.jpg" style="border-radius: 5px; border-style: groove;"></p>
<hr></section><section class="level2"><h2 id="output">8. Output data<a class="anchor" aria-label="anchor" href="#output"></a>
</h2>
<p>Once the app is done processing the video, the resulting CSV file will contain between 8 and 12 columns depending on whether you have set a real-world scale and origin in the “Scale module”. These columns will be the following:</p>
<ul>
<li>“frame” is the video frame number at which the measurements along the corresponding row have been made.</li>
<li>“track” is the identity of the tracked object as estimated by the app.</li>
<li>“x” is the x coordinate of the object location in pixels in the context of the video frame. The origin is set at the top-left corner of the frame.</li>
<li>“y” is the y coordinate of the object location in pixels in the context of the video frame. The origin is set at the top-left corner of the frame.</li>
<li>“width” is the width in pixels of the object.</li>
<li>“height” is the height in pixels of the object.</li>
<li>“angle” is the angle in degrees between the main axis of the object and the y axis.</li>
<li>“n” is the number of pixels covered by the object in the image.</li>
</ul>
<p>If you have set a real-world scale and origin in the “Tracking module”, the following extra columns will be saved:</p>
<ul>
<li>“x_[unit]” is the x coordinate of the object location in real-world [unit]. The origin is set to the real-worl equivalent to that you have defined in the “Scale module”.</li>
<li>“y_[unit]” is the y coordinate of the object location in real-world [unit]. The origin is set to the real-worl equivalent to that you have defined in the “Tracking module”.</li>
<li>“width_[unit]” is the width in real-world [unit] of the object.</li>
<li>“height_[unit]” is the height in real-world [unit] of the object.</li>
</ul>
<hr>
<p>The video used throughout this tutorial was provided by <em>Sridhar, V. H., Roche, D. G., and Gingins, S. (2019). Tracktor: Image-based automated tracking of animal movement and behaviour. Methods Ecol. Evol. 10, 691. doi:10.1111/2041-210X.13166</em> and used here with permission of the authors.</p>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Simon Garnier.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
